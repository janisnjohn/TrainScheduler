<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Train Scheduler</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/style.css">

</head>
<body>
  <div class="container">
  <div class="jumbotron text-center">
  <h1>Anytime is Traintime</h1>
  <h3>Your one stop place for your train schedule</h3>
  </div>
  <div class="panel panel-heading">
  <h4>Current Train Schedule</h4>
  <div class="panel panel-body">
    <table class="table table-hover" id="train-table">
    <thead>
      <tr>
        <th> Train Name</th>
        <th> Destination</th>
        <th> Frequency (min)</th>
        <th> Next Arrival</th>
        <th> Minutes Away</th>
      </tr>
    </thead>
    <tbody>
        <td id="name-display"></td>
        <td id="destination-display"></td>
        <td id="frequency-display"></td>
        <td id="nextArrival-display"></td>
        <td id="minutesAway-display"></td>
    </tbody>
    </table>
  </div>
  </div>
  <div class="panel panel-heading">
    <h4>Add Train</h4>
  </div>
  <div class="panel panel-default">
            <form role="form">
              <div class="form-group">
                <label for="name-input">Train Name:</label>
                <input class="form-control" id="name-input" type="text">
              </div>
              <div class="form-group">
                <label for="destination-input">Destination</label>
                <input class="form-control" id="destination-input" type="text">
              </div>
              <div class="form-group">
                <label for="firstTraintime-input">First Train Time (HH:mm - military time)</label>
                <input class="form-control" id="firstTraintime-input" type="text">
              </div>
              <div class="form-group">
                <label for="frequency-input">Frequency</label>
                <input class="form-control" id="frequency-input" type="text"></input>
              </div>
              <button class="btn btn-default" id="add-train" type="submit">Submit</button>
            </form>
  </div>
</div>
  
</body>
</html>


<script src="https://www.gstatic.com/firebasejs/4.3.0/firebase.js"></script>
<script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
<script>

$(document).ready(function(){

  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyAbW6nt4y-MphI8tzjbbdnwNoPIjMLPwiM",
    authDomain: "trainscheduler-3ca64.firebaseapp.com",
    databaseURL: "https://trainscheduler-3ca64.firebaseio.com",
    projectId: "trainscheduler-3ca64",
    storageBucket: "trainscheduler-3ca64.appspot.com",
    messagingSenderId: "745552260293"
  };

  firebase.initializeApp(config);

  var database = firebase.database();

  var name ="";
  var destination ="";
  var firstTraintime ="";
  var frequency = "";
  var firstTimeConverted = moment(firstTraintime, "hh:mm").subtract(1, "years");
  console.log(firstTimeConverted);
  var currentTime = moment();
  console.log("current time: " + currentTime);



    $("#add-train").on("click", function() {
      // Prevent the page from refreshing
      // event.preventDefault();

    name = $("#name-input").val().trim();
    destination = $("#destination-input").val().trim();
    firstTraintime = $("#firstTraintime-input").val().trim();
    console.log("starting time: " + firstTraintime);
    frequency =$("#frequency-input").val().trim();

  var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
  console.log("DIFFERENCE IN TIME: " + diffTime);
  var tRemainder = diffTime % frequency;
  console.log(tRemainder);
  var tMinutesTillTrain = frequency - tRemainder;
  console.log("MINUTES TILL TRAIN: " + tMinutesTillTrain);
  var nextTrain = moment().add(tMinutesTillTrain, "minutes");
  console.log("ARRIVAL TIME: " + moment(nextTrain).format("hh:mm"));


  database.ref().push( {
    name: name,
    destination: destination,
    firstTraintime: firstTraintime,
    frequency: frequency,
    nextTrain: nextTrain,
    tMinutesTillTrain: tMinutesTillTrain
    //time stamp in UNIX
    // dateAdded: firebase.database.ServerValue.TIMESTAMP 

});
});

    database.ref().on("child_added", function(childSnapshot){

      // Log everything that's coming out of snapshot
      console.log(childSnapshot.val().name);
      console.log(childSnapshot.val().destination);
      console.log(childSnapshot.val().firstTraintime);
      console.log(childSnapshot.val().frequency);

      var name = childSnapshot.val().trim();
      var currentTimestamp = momemt().format("HH:mm:ss");
      console.log(currentTimestamp);



      // $("#full-member-list").append("<div class='well'><span id='name'> " + childSnapshot.val().name +
      //   " </span><span id='email'> " + childSnapshot.val().email +
      //   " </span><span id='age'> " + childSnapshot.val().age +
      //   " </span><span id='comment'> " + childSnapshot.val().comment + " </span></div>");

    // Handle the errors
    }, function(errorObject) {
      console.log("Errors handled: " + errorObject.code);
    });


    database.ref().orderByChild("dateAdded").limitToLast(1).on("child_added", function (snapshot){
          // Change the HTML to reflect
//$("employee-table")

      $("#name-display").html(snapshot.val().name);
      $("#destination-display").html(snapshot.val().destination);
      $("#firstTraintime-display").html(snapshot.val().firstTraintime);
      $("#frequency-display").html(snapshot.val().frequency);
      $("#nextArrival-display").html();
      $("#minutesAway-display").html();
      // $("#monthsWorked-display").html(snapshot.val().startDate).diff(moment().format("months"));
    });
  });




//       $("#train-table > tbody").append("<tr><td>" + Name + "</td><td>" + destination + "</td><td>" +
//   firstTraintime + "</td><td>" + frequency + "</td></tr>");
// });


</script>